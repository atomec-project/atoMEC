

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>atoMEC.writeoutput &mdash; atoMEC  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/atoMEC_favicon.png"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> atoMEC
          

          
            
            <img src="../../_static/atoMEC_horizontal1.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/modules.html">atoMEC</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">atoMEC</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../atoMEC.html">atoMEC</a> &raquo;</li>
        
      <li>atoMEC.writeoutput</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for atoMEC.writeoutput</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Contains the routines which generate printed output (to screen and separate files).</span>

<span class="sd">Classes</span>
<span class="sd">-------</span>
<span class="sd">* :class:`SCF` : Write information about the self-consistent field (SCF) cycle.</span>

<span class="sd">Functions</span>
<span class="sd">---------</span>
<span class="sd">* :func:`write_atomic_data` : Write information about the main Atom object.</span>
<span class="sd">* :func:`write_ISModel_data` : Write information about the IS model.</span>
<span class="sd">* :func:`density_to_csv` : Write the KS density to file.</span>
<span class="sd">* :func:`potential_to_csv` : Write the KS potential to file.</span>
<span class="sd">* :func:`timing`: Generate timing information for given input function.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># standard libs</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1"># external libs</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">tabulate</span>

<span class="c1"># internal libs</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">unitconv</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">config</span>

<span class="c1"># define some line spacings</span>
<span class="n">spc</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="n">dblspc</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>


<div class="viewcode-block" id="write_atomic_data"><a class="viewcode-back" href="../../api/atoMEC.html#atoMEC.writeoutput.write_atomic_data">[docs]</a><span class="k">def</span> <span class="nf">write_atomic_data</span><span class="p">(</span><span class="n">atom</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write information about the main Atom object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    atom : atoMEC.Atom</span>
<span class="sd">        the main Atom object</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    output_str : str</span>
<span class="sd">        formatted description of the Atom attributes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># the initial spiel</span>
    <span class="n">init_str</span> <span class="o">=</span> <span class="s2">&quot;Atomic information:&quot;</span> <span class="o">+</span> <span class="n">dblspc</span>

    <span class="c1"># information about the atomic species</span>
    <span class="n">species_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{preamble:30s}</span><span class="s2">: </span><span class="si">{species:2s}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">preamble</span><span class="o">=</span><span class="s2">&quot;Atomic species&quot;</span><span class="p">,</span> <span class="n">species</span><span class="o">=</span><span class="n">atom</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">symbol</span>
    <span class="p">)</span>
    <span class="n">at_chrg_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{preamble:30s}</span><span class="s2">: </span><span class="si">{chrg:&lt;3d}</span><span class="s2"> / </span><span class="si">{weight:&lt;.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">preamble</span><span class="o">=</span><span class="s2">&quot;Atomic charge / weight&quot;</span><span class="p">,</span> <span class="n">chrg</span><span class="o">=</span><span class="n">atom</span><span class="o">.</span><span class="n">at_chrg</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">atom</span><span class="o">.</span><span class="n">at_mass</span>
    <span class="p">)</span>
    <span class="n">nvalence_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{preamble:30s}</span><span class="s2">: </span><span class="si">{nval:&lt;3d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">preamble</span><span class="o">=</span><span class="s2">&quot;Valence electrons&quot;</span><span class="p">,</span> <span class="n">nval</span><span class="o">=</span><span class="n">atom</span><span class="o">.</span><span class="n">nvalence</span>
    <span class="p">)</span>
    <span class="n">spec_info</span> <span class="o">=</span> <span class="n">species_str</span> <span class="o">+</span> <span class="n">spc</span> <span class="o">+</span> <span class="n">at_chrg_str</span> <span class="o">+</span> <span class="n">spc</span> <span class="o">+</span> <span class="n">nvalence_str</span> <span class="o">+</span> <span class="n">spc</span>

    <span class="c1"># information about the atomic / mass density</span>
    <span class="n">rho_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{preamble:30s}</span><span class="s2">: </span><span class="si">{rho:&lt;.3g}</span><span class="s2"> g cm^-3&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">preamble</span><span class="o">=</span><span class="s2">&quot;Mass density&quot;</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="n">atom</span><span class="o">.</span><span class="n">density</span>
    <span class="p">)</span>
    <span class="n">rad_ang</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">radius</span> <span class="o">/</span> <span class="n">unitconv</span><span class="o">.</span><span class="n">angstrom_to_bohr</span>
    <span class="n">rad_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{preamble:30s}</span><span class="s2">: </span><span class="si">{rad_b:&lt;.4g}</span><span class="s2"> Bohr / </span><span class="si">{rad_a:&lt;.4g}</span><span class="s2"> Angstrom&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">preamble</span><span class="o">=</span><span class="s2">&quot;Voronoi sphere radius&quot;</span><span class="p">,</span> <span class="n">rad_b</span><span class="o">=</span><span class="n">atom</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="n">rad_a</span><span class="o">=</span><span class="n">rad_ang</span>
    <span class="p">)</span>
    <span class="n">rho_info</span> <span class="o">=</span> <span class="n">rho_str</span> <span class="o">+</span> <span class="n">spc</span> <span class="o">+</span> <span class="n">rad_str</span> <span class="o">+</span> <span class="n">spc</span>

    <span class="c1"># information about the temperature</span>
    <span class="n">temp_ev</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">temp</span> <span class="o">/</span> <span class="n">unitconv</span><span class="o">.</span><span class="n">ev_to_ha</span>
    <span class="n">temp_K</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">temp</span> <span class="o">/</span> <span class="n">unitconv</span><span class="o">.</span><span class="n">K_to_ha</span>
    <span class="n">temp_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{preamble:30s}</span><span class="s2">: </span><span class="si">{t_ha:&lt;.4g}</span><span class="s2"> Ha /  </span><span class="si">{t_ev:&lt;.4g}</span><span class="s2"> eV / </span><span class="si">{t_k:&lt;.4g}</span><span class="s2"> K&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">preamble</span><span class="o">=</span><span class="s2">&quot;Electronic temperature&quot;</span><span class="p">,</span> <span class="n">t_ha</span><span class="o">=</span><span class="n">atom</span><span class="o">.</span><span class="n">temp</span><span class="p">,</span> <span class="n">t_ev</span><span class="o">=</span><span class="n">temp_ev</span><span class="p">,</span> <span class="n">t_k</span><span class="o">=</span><span class="n">temp_K</span>
    <span class="p">)</span>
    <span class="n">temp_info</span> <span class="o">=</span> <span class="n">temp_str</span> <span class="o">+</span> <span class="n">spc</span>

    <span class="c1"># information about the dimensionless parameters</span>
    <span class="n">WS_radius_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{preamble:30s}</span><span class="s2">: </span><span class="si">{rad:&lt;.4g}</span><span class="s2"> (Bohr)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">preamble</span><span class="o">=</span><span class="s2">&quot;Wigner-Seitz radius&quot;</span><span class="p">,</span> <span class="n">rad</span><span class="o">=</span><span class="n">atom</span><span class="o">.</span><span class="n">WS_radius</span>
    <span class="p">)</span>
    <span class="n">gamma_i_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{preamble:30s}</span><span class="s2">: </span><span class="si">{gamma:&lt;.4g}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">preamble</span><span class="o">=</span><span class="s2">&quot;Ionic coupling parameter&quot;</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="n">atom</span><span class="o">.</span><span class="n">gamma_ion</span>
    <span class="p">)</span>
    <span class="n">theta_e_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{preamble:30s}</span><span class="s2">: </span><span class="si">{theta:&lt;.4g}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">preamble</span><span class="o">=</span><span class="s2">&quot;Electron degeneracy parameter&quot;</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="n">atom</span><span class="o">.</span><span class="n">theta_e</span>
    <span class="p">)</span>

    <span class="n">dim_params_str</span> <span class="o">=</span> <span class="n">WS_radius_str</span> <span class="o">+</span> <span class="n">spc</span> <span class="o">+</span> <span class="n">gamma_i_str</span> <span class="o">+</span> <span class="n">spc</span> <span class="o">+</span> <span class="n">theta_e_str</span> <span class="o">+</span> <span class="n">spc</span>

    <span class="c1"># put all into a single string</span>
    <span class="n">output_str</span> <span class="o">=</span> <span class="n">init_str</span> <span class="o">+</span> <span class="n">spec_info</span> <span class="o">+</span> <span class="n">rho_info</span> <span class="o">+</span> <span class="n">temp_info</span> <span class="o">+</span> <span class="n">dim_params_str</span> <span class="o">+</span> <span class="n">spc</span>

    <span class="k">return</span> <span class="n">output_str</span></div>


<div class="viewcode-block" id="write_ISModel_data"><a class="viewcode-back" href="../../api/atoMEC.html#atoMEC.writeoutput.write_ISModel_data">[docs]</a><span class="k">def</span> <span class="nf">write_ISModel_data</span><span class="p">(</span><span class="n">ISModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write information about the approximations used for the IS model.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ISModel : models.ISModel</span>
<span class="sd">        The ISModel object</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    output_str : str</span>
<span class="sd">        formatted description of the ISModel attributes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># the initial spiel</span>
    <span class="n">init_str</span> <span class="o">=</span> <span class="s2">&quot;Using Ion-Sphere model&quot;</span> <span class="o">+</span> <span class="n">spc</span> <span class="o">+</span> <span class="s2">&quot;Ion-sphere model parameters: &quot;</span> <span class="o">+</span> <span class="n">dblspc</span>

    <span class="c1"># spin-pol information</span>
    <span class="n">spinpol_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{preamble:30s}</span><span class="s2">: </span><span class="si">{spin}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">preamble</span><span class="o">=</span><span class="s2">&quot;Spin-polarized&quot;</span><span class="p">,</span> <span class="n">spin</span><span class="o">=</span><span class="n">ISModel</span><span class="o">.</span><span class="n">spinpol</span>
    <span class="p">)</span>
    <span class="n">spinpol_info</span> <span class="o">=</span> <span class="n">spinpol_str</span> <span class="o">+</span> <span class="n">spc</span>

    <span class="c1"># number of electrons in each spin channel info</span>
    <span class="n">nele</span> <span class="o">=</span> <span class="n">ISModel</span><span class="o">.</span><span class="n">nele</span>
    <span class="k">if</span> <span class="n">ISModel</span><span class="o">.</span><span class="n">spinpol</span><span class="p">:</span>
        <span class="n">pre</span> <span class="o">=</span> <span class="s2">&quot;Number of up / down electrons&quot;</span>
        <span class="n">nele_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{preamble:30s}</span><span class="s2">: </span><span class="si">{Nu}</span><span class="s2"> / </span><span class="si">{Nd}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">preamble</span><span class="o">=</span><span class="n">pre</span><span class="p">,</span> <span class="n">Nu</span><span class="o">=</span><span class="n">nele</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Nd</span><span class="o">=</span><span class="n">nele</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pre</span> <span class="o">=</span> <span class="s2">&quot;Number of electrons&quot;</span>
        <span class="n">nele_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{preamble:30s}</span><span class="s2">: </span><span class="si">{Ne}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">preamble</span><span class="o">=</span><span class="n">pre</span><span class="p">,</span> <span class="n">Ne</span><span class="o">=</span><span class="n">nele</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">nele_info</span> <span class="o">=</span> <span class="n">nele_str</span> <span class="o">+</span> <span class="n">spc</span>

    <span class="c1"># exchange functional</span>
    <span class="n">xfunc_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{preamble:30s}</span><span class="s2">: </span><span class="si">{xfunc}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">preamble</span><span class="o">=</span><span class="s2">&quot;Exchange functional&quot;</span><span class="p">,</span> <span class="n">xfunc</span><span class="o">=</span><span class="n">ISModel</span><span class="o">.</span><span class="n">xfunc_id</span>
    <span class="p">)</span>
    <span class="n">cfunc_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{preamble:30s}</span><span class="s2">: </span><span class="si">{cfunc}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">preamble</span><span class="o">=</span><span class="s2">&quot;Correlation functional&quot;</span><span class="p">,</span> <span class="n">cfunc</span><span class="o">=</span><span class="n">ISModel</span><span class="o">.</span><span class="n">cfunc_id</span>
    <span class="p">)</span>
    <span class="n">xc_info</span> <span class="o">=</span> <span class="n">xfunc_str</span> <span class="o">+</span> <span class="n">spc</span> <span class="o">+</span> <span class="n">cfunc_str</span> <span class="o">+</span> <span class="n">spc</span>

    <span class="c1"># boundary condition</span>
    <span class="n">bc_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{preamble:30s}</span><span class="s2">: </span><span class="si">{bc}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">preamble</span><span class="o">=</span><span class="s2">&quot;Boundary condition&quot;</span><span class="p">,</span> <span class="n">bc</span><span class="o">=</span><span class="n">ISModel</span><span class="o">.</span><span class="n">bc</span><span class="p">)</span>
    <span class="n">bc_info</span> <span class="o">=</span> <span class="n">bc_str</span> <span class="o">+</span> <span class="n">spc</span>

    <span class="c1"># unbound electrons</span>
    <span class="n">ub_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{preamble:30s}</span><span class="s2">: </span><span class="si">{ub}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">preamble</span><span class="o">=</span><span class="s2">&quot;Unbound electron treatment&quot;</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="n">ISModel</span><span class="o">.</span><span class="n">unbound</span>
    <span class="p">)</span>
    <span class="n">ub_info</span> <span class="o">=</span> <span class="n">ub_str</span> <span class="o">+</span> <span class="n">spc</span>

    <span class="c1"># potential shift</span>
    <span class="n">vshift_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{preamble:30s}</span><span class="s2">: </span><span class="si">{spin}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">preamble</span><span class="o">=</span><span class="s2">&quot;Shift KS potential&quot;</span><span class="p">,</span> <span class="n">spin</span><span class="o">=</span><span class="n">ISModel</span><span class="o">.</span><span class="n">v_shift</span>
    <span class="p">)</span>
    <span class="n">vshift_info</span> <span class="o">=</span> <span class="n">vshift_str</span> <span class="o">+</span> <span class="n">spc</span>

    <span class="n">output_str</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">init_str</span>
        <span class="o">+</span> <span class="n">spinpol_info</span>
        <span class="o">+</span> <span class="n">nele_info</span>
        <span class="o">+</span> <span class="n">xc_info</span>
        <span class="o">+</span> <span class="n">bc_info</span>
        <span class="o">+</span> <span class="n">ub_info</span>
        <span class="o">+</span> <span class="n">vshift_info</span>
        <span class="o">+</span> <span class="n">spc</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">output_str</span></div>


<div class="viewcode-block" id="SCF"><a class="viewcode-back" href="../../api/atoMEC.html#atoMEC.writeoutput.SCF">[docs]</a><span class="k">class</span> <span class="nc">SCF</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write information about the self-consistent field (SCF) cycle.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="SCF.write_init"><a class="viewcode-back" href="../../api/atoMEC.html#atoMEC.writeoutput.SCF.write_init">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">write_init</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write the initial spiel for an SCF calculation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        output_str : str</span>
<span class="sd">            header string for SCF cycle</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># the initial message</span>
        <span class="n">init_str</span> <span class="o">=</span> <span class="s2">&quot;Starting SCF energy calculation&quot;</span> <span class="o">+</span> <span class="n">dblspc</span>

        <span class="c1"># spacing between terms</span>
        <span class="n">termspc</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="s2">&quot; &quot;</span>

        <span class="c1"># main output string</span>
        <span class="n">E_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{E:12s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">E</span><span class="o">=</span><span class="s2">&quot;E_free (Ha)&quot;</span><span class="p">)</span>
        <span class="n">dE_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{dE:2s}</span><span class="s2"> (</span><span class="si">{dE_x:&lt;4.1e}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">dE</span><span class="o">=</span><span class="s2">&quot;dE&quot;</span><span class="p">,</span> <span class="n">dE_x</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">conv_params</span><span class="p">[</span><span class="s2">&quot;econv&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">dn_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{dn:2s}</span><span class="s2"> (</span><span class="si">{dn_x:&lt;4.1e}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">dn</span><span class="o">=</span><span class="s2">&quot;dn&quot;</span><span class="p">,</span> <span class="n">dn_x</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">conv_params</span><span class="p">[</span><span class="s2">&quot;nconv&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">dv_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{dv:2s}</span><span class="s2"> (</span><span class="si">{dv_x:&lt;4.1e}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">dv</span><span class="o">=</span><span class="s2">&quot;dv&quot;</span><span class="p">,</span> <span class="n">dv_x</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">conv_params</span><span class="p">[</span><span class="s2">&quot;vconv&quot;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="n">main_str</span> <span class="o">=</span> <span class="n">termspc</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;iscf&quot;</span><span class="p">,</span> <span class="n">E_str</span><span class="p">,</span> <span class="n">dE_str</span><span class="p">,</span> <span class="n">dn_str</span><span class="p">,</span> <span class="n">dv_str</span><span class="p">])</span> <span class="o">+</span> <span class="n">spc</span>
        <span class="n">buffer_str</span> <span class="o">=</span> <span class="mi">65</span> <span class="o">*</span> <span class="s2">&quot;-&quot;</span>

        <span class="n">output_str</span> <span class="o">=</span> <span class="n">init_str</span> <span class="o">+</span> <span class="n">main_str</span> <span class="o">+</span> <span class="n">buffer_str</span>
        <span class="k">return</span> <span class="n">output_str</span></div>

<div class="viewcode-block" id="SCF.write_cycle"><a class="viewcode-back" href="../../api/atoMEC.html#atoMEC.writeoutput.SCF.write_cycle">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">write_cycle</span><span class="p">(</span><span class="n">iscf</span><span class="p">,</span> <span class="n">E_free</span><span class="p">,</span> <span class="n">conv_vals</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write output string for each SCF iteration.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        iscf : int</span>
<span class="sd">            the iteration number</span>
<span class="sd">        E_free : float</span>
<span class="sd">            the total free energy</span>
<span class="sd">        conv_vals: dict</span>
<span class="sd">            dictionary of convergence values</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        output_str : str</span>
<span class="sd">            free energy and convergence values for the i-th iteration</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">termspc</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="s2">&quot; &quot;</span>

        <span class="n">iscf_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{i:4d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">iscf</span><span class="p">)</span>
        <span class="n">E_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{E:12.7f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">E</span><span class="o">=</span><span class="n">E_free</span><span class="p">)</span>
        <span class="n">dE_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{dE:12.3e}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dE</span><span class="o">=</span><span class="n">conv_vals</span><span class="p">[</span><span class="s2">&quot;dE&quot;</span><span class="p">])</span>
        <span class="n">dn_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{dn:12.3e}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dn</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">conv_vals</span><span class="p">[</span><span class="s2">&quot;drho&quot;</span><span class="p">]))</span>
        <span class="n">dv_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{dv:12.3e}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dv</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">conv_vals</span><span class="p">[</span><span class="s2">&quot;dpot&quot;</span><span class="p">]))</span>

        <span class="n">output</span> <span class="o">=</span> <span class="n">termspc</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">iscf_str</span><span class="p">,</span> <span class="n">E_str</span><span class="p">,</span> <span class="n">dE_str</span><span class="p">,</span> <span class="n">dn_str</span><span class="p">,</span> <span class="n">dv_str</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">output</span></div>

<div class="viewcode-block" id="SCF.write_final"><a class="viewcode-back" href="../../api/atoMEC.html#atoMEC.writeoutput.SCF.write_final">[docs]</a>    <span class="k">def</span> <span class="nf">write_final</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">orbitals</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">conv_vals</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write final post-SCF information about energy, orbitals and convergence.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        energy : staticKS.Energy</span>
<span class="sd">            the energy object</span>
<span class="sd">        orbitals : staticKS.Orbitals</span>
<span class="sd">            the orbitals object</span>
<span class="sd">        density: staticKS.Density</span>
<span class="sd">            the density object</span>
<span class="sd">        conv_vals : dict</span>
<span class="sd">            dictionary of convergence values</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        output_str : str</span>
<span class="sd">            information about whether the calculation converged, the final energies</span>
<span class="sd">            (broken down into components), and the orbital energies and occupations</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output_str</span> <span class="o">=</span> <span class="mi">65</span> <span class="o">*</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="n">spc</span>

        <span class="c1"># write whether convergence cycle succesfully completed</span>
        <span class="k">if</span> <span class="n">conv_vals</span><span class="p">[</span><span class="s2">&quot;complete&quot;</span><span class="p">]:</span>
            <span class="n">output_str</span> <span class="o">+=</span> <span class="s2">&quot;SCF cycle converged&quot;</span> <span class="o">+</span> <span class="n">dblspc</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output_str</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="n">output_str</span>
                <span class="o">+</span> <span class="s2">&quot;SCF cycle did not converge in &quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">scf_params</span><span class="p">[</span><span class="s2">&quot;maxscf&quot;</span><span class="p">])</span>
                <span class="o">+</span> <span class="s2">&quot; iterations&quot;</span>
                <span class="o">+</span> <span class="n">dblspc</span>
            <span class="p">)</span>

        <span class="c1"># write the total energies</span>
        <span class="n">output_str</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_final_energies</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span> <span class="o">+</span> <span class="n">spc</span>

        <span class="c1"># write the chemical potential and mean ionization state</span>
        <span class="n">N_ub</span> <span class="o">=</span> <span class="n">density</span><span class="o">.</span><span class="n">MIS</span>

        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">spindims</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">mu_str</span> <span class="o">=</span> <span class="s2">&quot;Chemical potential (u/d)&quot;</span>
            <span class="n">chem_pot_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{mu:30s}</span><span class="s2"> : </span><span class="si">{mu1:7.3f}</span><span class="s2"> / </span><span class="si">{mu2:&lt;7.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">mu</span><span class="o">=</span><span class="n">mu_str</span><span class="p">,</span> <span class="n">mu1</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">mu</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mu2</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">mu</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">N_ub_str</span> <span class="o">=</span> <span class="s2">&quot;Mean ionization state (u/d)&quot;</span>
            <span class="n">MIS_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{Nub:30s}</span><span class="s2"> : </span><span class="si">{Nub1:7.3f}</span><span class="s2"> / </span><span class="si">{Nub2:&lt;7.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">Nub</span><span class="o">=</span><span class="n">N_ub_str</span><span class="p">,</span> <span class="n">Nub1</span><span class="o">=</span><span class="n">N_ub</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Nub2</span><span class="o">=</span><span class="n">N_ub</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">config</span><span class="o">.</span><span class="n">spindims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">mu_str</span> <span class="o">=</span> <span class="s2">&quot;Chemical potential&quot;</span>
            <span class="n">chem_pot_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{mu:30s}</span><span class="s2"> : </span><span class="si">{mu1:7.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="n">mu_str</span><span class="p">,</span> <span class="n">mu1</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">mu</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">N_ub_str</span> <span class="o">=</span> <span class="s2">&quot;Mean ionization state&quot;</span>
            <span class="n">MIS_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{Nub:30s}</span><span class="s2"> : </span><span class="si">{Nub1:7.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Nub</span><span class="o">=</span><span class="n">N_ub_str</span><span class="p">,</span> <span class="n">Nub1</span><span class="o">=</span><span class="n">N_ub</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">output_str</span> <span class="o">+=</span> <span class="n">spc</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">chem_pot_str</span><span class="p">,</span> <span class="n">MIS_str</span><span class="p">])</span>

        <span class="n">eigvals</span><span class="p">,</span> <span class="n">occnums</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_orb_info</span><span class="p">(</span><span class="n">orbitals</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">bc</span> <span class="o">==</span> <span class="s2">&quot;bands&quot;</span><span class="p">:</span>
            <span class="n">output_str</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="n">dblspc</span> <span class="o">+</span> <span class="s2">&quot;Orbital eigenvalues (band limits) (Ha) :&quot;</span> <span class="o">+</span> <span class="n">dblspc</span> <span class="o">+</span> <span class="n">eigvals</span>
            <span class="p">)</span>
            <span class="n">output_str</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="n">spc</span> <span class="o">+</span> <span class="s2">&quot;Weighted band occupations (sum over k pts) :&quot;</span> <span class="o">+</span> <span class="n">dblspc</span> <span class="o">+</span> <span class="n">occnums</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output_str</span> <span class="o">+=</span> <span class="n">dblspc</span> <span class="o">+</span> <span class="s2">&quot;Orbital eigenvalues (Ha) :&quot;</span> <span class="o">+</span> <span class="n">dblspc</span> <span class="o">+</span> <span class="n">eigvals</span>
            <span class="n">output_str</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="n">spc</span> <span class="o">+</span> <span class="s2">&quot;Orbital occupations (2l+1) * f_</span><span class="si">{nl}</span><span class="s2"> :&quot;</span> <span class="o">+</span> <span class="n">dblspc</span> <span class="o">+</span> <span class="n">occnums</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">output_str</span></div>

<div class="viewcode-block" id="SCF.write_final_energies"><a class="viewcode-back" href="../../api/atoMEC.html#atoMEC.writeoutput.SCF.write_final_energies">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">write_final_energies</span><span class="p">(</span><span class="n">energy</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write formatted KS energy information (by component).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        energy : staticKS.Energy</span>
<span class="sd">            the KS energy object</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        output_str : str</span>
<span class="sd">            formatted output string of energies by component</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output_str</span> <span class="o">=</span> <span class="s2">&quot;Final energies (Ha)&quot;</span> <span class="o">+</span> <span class="n">dblspc</span>
        <span class="n">box_str</span> <span class="o">=</span> <span class="mi">45</span> <span class="o">*</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="n">spc</span>
        <span class="n">output_str</span> <span class="o">+=</span> <span class="n">box_str</span>

        <span class="c1"># write the kinetic energy information</span>
        <span class="n">E_kin</span> <span class="o">=</span> <span class="n">energy</span><span class="o">.</span><span class="n">E_kin</span>
        <span class="n">KE_str</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{KE:30s}</span><span class="s2"> : </span><span class="si">{KE_x:10.4f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">KE</span><span class="o">=</span><span class="s2">&quot;Kinetic energy&quot;</span><span class="p">,</span> <span class="n">KE_x</span><span class="o">=</span><span class="n">E_kin</span><span class="p">[</span><span class="s2">&quot;tot&quot;</span><span class="p">])</span>
            <span class="o">+</span> <span class="n">spc</span>
        <span class="p">)</span>
        <span class="n">KE_str</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="mi">4</span> <span class="o">*</span> <span class="s2">&quot; &quot;</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{KE:26s}</span><span class="s2"> : </span><span class="si">{KE_x:10.4f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">KE</span><span class="o">=</span><span class="s2">&quot;orbitals&quot;</span><span class="p">,</span> <span class="n">KE_x</span><span class="o">=</span><span class="n">E_kin</span><span class="p">[</span><span class="s2">&quot;bound&quot;</span><span class="p">])</span>
            <span class="o">+</span> <span class="n">spc</span>
        <span class="p">)</span>
        <span class="n">KE_str</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="mi">4</span> <span class="o">*</span> <span class="s2">&quot; &quot;</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{KE:26s}</span><span class="s2"> : </span><span class="si">{KE_x:10.4f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">KE</span><span class="o">=</span><span class="s2">&quot;unbound ideal approx.&quot;</span><span class="p">,</span> <span class="n">KE_x</span><span class="o">=</span><span class="n">E_kin</span><span class="p">[</span><span class="s2">&quot;unbound&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="o">+</span> <span class="n">spc</span>
        <span class="p">)</span>

        <span class="n">output_str</span> <span class="o">+=</span> <span class="n">KE_str</span>

        <span class="c1"># electron-nuclear contribution</span>
        <span class="n">en_str</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{en:30s}</span><span class="s2"> : </span><span class="si">{E_en:10.4f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">en</span><span class="o">=</span><span class="s2">&quot;Electron-nuclear energy&quot;</span><span class="p">,</span> <span class="n">E_en</span><span class="o">=</span><span class="n">energy</span><span class="o">.</span><span class="n">E_en</span>
            <span class="p">)</span>
            <span class="o">+</span> <span class="n">spc</span>
        <span class="p">)</span>
        <span class="n">output_str</span> <span class="o">+=</span> <span class="n">en_str</span>

        <span class="c1"># hartree contribution</span>
        <span class="n">ha_str</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{Ha:30s}</span><span class="s2"> : </span><span class="si">{E_ha:10.4f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Ha</span><span class="o">=</span><span class="s2">&quot;Hartree energy&quot;</span><span class="p">,</span> <span class="n">E_ha</span><span class="o">=</span><span class="n">energy</span><span class="o">.</span><span class="n">E_ha</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">spc</span>
        <span class="p">)</span>
        <span class="n">output_str</span> <span class="o">+=</span> <span class="n">ha_str</span>

        <span class="c1"># exchange-correlation (broken down into components)</span>
        <span class="n">E_xc</span> <span class="o">=</span> <span class="n">energy</span><span class="o">.</span><span class="n">E_xc</span>
        <span class="n">xc_str</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{xc:30s}</span><span class="s2"> : </span><span class="si">{xc_x:10.4f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">xc</span><span class="o">=</span><span class="s2">&quot;Exchange-correlation energy&quot;</span><span class="p">,</span> <span class="n">xc_x</span><span class="o">=</span><span class="n">E_xc</span><span class="p">[</span><span class="s2">&quot;xc&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="o">+</span> <span class="n">spc</span>
        <span class="p">)</span>
        <span class="n">xc_str</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="mi">4</span> <span class="o">*</span> <span class="s2">&quot; &quot;</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{xc:26s}</span><span class="s2"> : </span><span class="si">{xc_x:10.4f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xc</span><span class="o">=</span><span class="s2">&quot;exchange&quot;</span><span class="p">,</span> <span class="n">xc_x</span><span class="o">=</span><span class="n">E_xc</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">])</span>
            <span class="o">+</span> <span class="n">spc</span>
        <span class="p">)</span>
        <span class="n">xc_str</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="mi">4</span> <span class="o">*</span> <span class="s2">&quot; &quot;</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{xc:26s}</span><span class="s2"> : </span><span class="si">{xc_x:10.4f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xc</span><span class="o">=</span><span class="s2">&quot;correlation&quot;</span><span class="p">,</span> <span class="n">xc_x</span><span class="o">=</span><span class="n">E_xc</span><span class="p">[</span><span class="s2">&quot;c&quot;</span><span class="p">])</span>
            <span class="o">+</span> <span class="n">spc</span>
        <span class="p">)</span>

        <span class="n">output_str</span> <span class="o">+=</span> <span class="n">xc_str</span>

        <span class="c1"># total energy</span>
        <span class="n">tot_E_str</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">box_str</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{tot:30s}</span><span class="s2"> : </span><span class="si">{E_tot:10.4f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tot</span><span class="o">=</span><span class="s2">&quot;Total energy&quot;</span><span class="p">,</span> <span class="n">E_tot</span><span class="o">=</span><span class="n">energy</span><span class="o">.</span><span class="n">E_tot</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">spc</span>
            <span class="o">+</span> <span class="n">box_str</span>
        <span class="p">)</span>
        <span class="n">output_str</span> <span class="o">+=</span> <span class="n">tot_E_str</span>

        <span class="c1"># entropy (split into bound / unbound)</span>
        <span class="n">ent</span> <span class="o">=</span> <span class="n">energy</span><span class="o">.</span><span class="n">entropy</span>
        <span class="n">ent_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{S:30s}</span><span class="s2"> : </span><span class="si">{S_x:10.4f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">S</span><span class="o">=</span><span class="s2">&quot;Entropy&quot;</span><span class="p">,</span> <span class="n">S_x</span><span class="o">=</span><span class="n">ent</span><span class="p">[</span><span class="s2">&quot;tot&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="n">spc</span>
        <span class="n">ent_str</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="mi">4</span> <span class="o">*</span> <span class="s2">&quot; &quot;</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{S:26s}</span><span class="s2"> : </span><span class="si">{S_x:10.4f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">S</span><span class="o">=</span><span class="s2">&quot;orbitals&quot;</span><span class="p">,</span> <span class="n">S_x</span><span class="o">=</span><span class="n">ent</span><span class="p">[</span><span class="s2">&quot;bound&quot;</span><span class="p">])</span>
            <span class="o">+</span> <span class="n">spc</span>
        <span class="p">)</span>
        <span class="n">ent_str</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="mi">4</span> <span class="o">*</span> <span class="s2">&quot; &quot;</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{S:26s}</span><span class="s2"> : </span><span class="si">{S_x:10.4f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">S</span><span class="o">=</span><span class="s2">&quot;unbound ideal approx.&quot;</span><span class="p">,</span> <span class="n">S_x</span><span class="o">=</span><span class="n">ent</span><span class="p">[</span><span class="s2">&quot;unbound&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="o">+</span> <span class="n">spc</span>
        <span class="p">)</span>

        <span class="n">output_str</span> <span class="o">+=</span> <span class="n">ent_str</span>

        <span class="c1"># total free energy F = E - T * S</span>
        <span class="n">tot_F_str</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">box_str</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{F:30s}</span><span class="s2"> : </span><span class="si">{F_x:10.4f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">F</span><span class="o">=</span><span class="s2">&quot;Total free energy&quot;</span><span class="p">,</span> <span class="n">F_x</span><span class="o">=</span><span class="n">energy</span><span class="o">.</span><span class="n">F_tot</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">spc</span>
            <span class="o">+</span> <span class="n">box_str</span>
        <span class="p">)</span>
        <span class="n">output_str</span> <span class="o">+=</span> <span class="n">tot_F_str</span>

        <span class="k">return</span> <span class="n">output_str</span></div>

<div class="viewcode-block" id="SCF.write_orb_info"><a class="viewcode-back" href="../../api/atoMEC.html#atoMEC.writeoutput.SCF.write_orb_info">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">write_orb_info</span><span class="p">(</span><span class="n">orbitals</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write formatted KS orbital information.</span>

<span class="sd">        Information up to to the highest occupied level +1 (for both n and l)</span>
<span class="sd">        is included; remaining levels are truncated.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        orbitals : staticKS.Orbitals</span>
<span class="sd">            the KS orbitals object</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        eigs_occs : tuple[str,str]</span>
<span class="sd">            a tuple containing formatted eigenvalue table eigval_tbl,</span>
<span class="sd">            and formatted occupation numbers table occnum_tbl</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># loop over the spin dimensions</span>
        <span class="n">eigval_tbl</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">occnum_tbl</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">spindims</span><span class="p">):</span>

            <span class="c1"># truncate the table otherwise it becomes too large</span>

            <span class="n">lmax_new</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">lmax</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
            <span class="n">nmax_new</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">nmax</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

            <span class="c1"># define row and column headers</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nmax_new</span><span class="p">)]</span>
            <span class="n">headers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;n=l+1&quot;</span>
            <span class="n">RowIDs</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="nb">range</span><span class="p">(</span><span class="n">lmax_new</span><span class="p">)]</span>
            <span class="n">RowIDs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;l=0&quot;</span>

            <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">bc</span> <span class="o">==</span> <span class="s2">&quot;bands&quot;</span><span class="p">:</span>
                <span class="n">eigvals_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">orbitals</span><span class="o">.</span><span class="n">eigvals_min</span><span class="p">,</span> <span class="n">orbitals</span><span class="o">.</span><span class="n">eigvals_max</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">eigvals_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">orbitals</span><span class="o">.</span><span class="n">eigvals</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

            <span class="k">for</span> <span class="n">eigvals</span> <span class="ow">in</span> <span class="n">eigvals_list</span><span class="p">:</span>
                <span class="n">eigvals_new</span> <span class="o">=</span> <span class="n">eigvals</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="n">lmax_new</span><span class="p">,</span> <span class="p">:</span><span class="n">nmax_new</span><span class="p">]</span>

                <span class="c1"># the eigenvalue table</span>
                <span class="n">eigval_tbl</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="n">tabulate</span><span class="o">.</span><span class="n">tabulate</span><span class="p">(</span>
                        <span class="n">eigvals_new</span><span class="p">,</span>
                        <span class="n">headers</span><span class="p">,</span>
                        <span class="n">tablefmt</span><span class="o">=</span><span class="s2">&quot;presto&quot;</span><span class="p">,</span>
                        <span class="n">showindex</span><span class="o">=</span><span class="n">RowIDs</span><span class="p">,</span>
                        <span class="n">floatfmt</span><span class="o">=</span><span class="s2">&quot;7.3f&quot;</span><span class="p">,</span>
                        <span class="n">stralign</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="o">+</span> <span class="n">dblspc</span>
                <span class="p">)</span>

            <span class="c1"># sum up the occupation numbers over each band</span>
            <span class="n">occnums_band</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">orbitals</span><span class="o">.</span><span class="n">occnums_w</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">occnums_new</span> <span class="o">=</span> <span class="n">occnums_band</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="n">lmax_new</span><span class="p">,</span> <span class="p">:</span><span class="n">nmax_new</span><span class="p">]</span>

            <span class="c1"># the occnums table</span>
            <span class="n">occnum_tbl</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="n">tabulate</span><span class="o">.</span><span class="n">tabulate</span><span class="p">(</span>
                    <span class="n">occnums_new</span><span class="p">,</span>
                    <span class="n">headers</span><span class="p">,</span>
                    <span class="n">tablefmt</span><span class="o">=</span><span class="s2">&quot;presto&quot;</span><span class="p">,</span>
                    <span class="n">showindex</span><span class="o">=</span><span class="n">RowIDs</span><span class="p">,</span>
                    <span class="n">floatfmt</span><span class="o">=</span><span class="s2">&quot;7.3f&quot;</span><span class="p">,</span>
                    <span class="n">stralign</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="o">+</span> <span class="n">dblspc</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">eigval_tbl</span><span class="p">,</span> <span class="n">occnum_tbl</span></div></div>


<div class="viewcode-block" id="density_to_csv"><a class="viewcode-back" href="../../api/atoMEC.html#atoMEC.writeoutput.density_to_csv">[docs]</a><span class="k">def</span> <span class="nf">density_to_csv</span><span class="p">(</span><span class="n">rgrid</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write the density (on the r-grid) to file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rgrid : ndarray</span>
<span class="sd">        real-space grid</span>
<span class="sd">    density : staticKS.Density</span>
<span class="sd">        the KS density object</span>
<span class="sd">    filename : str</span>
<span class="sd">        name of the file to write to</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">spindims</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c1"># right-justifing column heads with fixed width of 12 characters</span>
        <span class="n">headstr</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">s</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="s2">&quot;r (a_0)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;n^u (orbs)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;n^u (ideal)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;n^d (orbs)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;n^d (ideal)&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">rgrid</span><span class="p">,</span>
                <span class="n">density</span><span class="o">.</span><span class="n">bound</span><span class="p">[</span><span class="s2">&quot;rho&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">density</span><span class="o">.</span><span class="n">unbound</span><span class="p">[</span><span class="s2">&quot;rho&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">density</span><span class="o">.</span><span class="n">bound</span><span class="p">[</span><span class="s2">&quot;rho&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">density</span><span class="o">.</span><span class="n">unbound</span><span class="p">[</span><span class="s2">&quot;rho&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
            <span class="p">]</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># right-justifing column heads with fixed width of 12 characters</span>
        <span class="n">headstr</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;r (a_0)&quot;</span><span class="p">,</span> <span class="s2">&quot;n (orbs)&quot;</span><span class="p">,</span> <span class="s2">&quot;n (ideal)&quot;</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">rgrid</span><span class="p">,</span> <span class="n">density</span><span class="o">.</span><span class="n">bound</span><span class="p">[</span><span class="s2">&quot;rho&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">density</span><span class="o">.</span><span class="n">unbound</span><span class="p">[</span><span class="s2">&quot;rho&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
        <span class="p">)</span>

    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%11.6e</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">headstr</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">return</span></div>


<div class="viewcode-block" id="potential_to_csv"><a class="viewcode-back" href="../../api/atoMEC.html#atoMEC.writeoutput.potential_to_csv">[docs]</a><span class="k">def</span> <span class="nf">potential_to_csv</span><span class="p">(</span><span class="n">rgrid</span><span class="p">,</span> <span class="n">potential</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write the potential (on the r-grid) to file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rgrid : ndarray</span>
<span class="sd">        real-space grid</span>
<span class="sd">    density : staticKS.Potential</span>
<span class="sd">        the KS potential object</span>
<span class="sd">    filename : str</span>
<span class="sd">        name of the file to write to</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">spindims</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c1"># right-justifing column heads with fixed width of 12 characters</span>
        <span class="n">headstr</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">s</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;r (a_0)&quot;</span><span class="p">,</span> <span class="s2">&quot;v_en&quot;</span><span class="p">,</span> <span class="s2">&quot;v_ha&quot;</span><span class="p">,</span> <span class="s2">&quot;v^u_xc&quot;</span><span class="p">,</span> <span class="s2">&quot;v^d_xc&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">rgrid</span><span class="p">,</span>
                <span class="n">potential</span><span class="o">.</span><span class="n">v_en</span><span class="p">,</span>
                <span class="n">potential</span><span class="o">.</span><span class="n">v_ha</span><span class="p">,</span>
                <span class="n">potential</span><span class="o">.</span><span class="n">v_xc</span><span class="p">[</span><span class="s2">&quot;xc&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">potential</span><span class="o">.</span><span class="n">v_xc</span><span class="p">[</span><span class="s2">&quot;xc&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">]</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># right-justifing column heads with fixed width of 12 characters</span>
        <span class="n">headstr</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;r (a_0)&quot;</span><span class="p">,</span> <span class="s2">&quot;v_en&quot;</span><span class="p">,</span> <span class="s2">&quot;v_ha&quot;</span><span class="p">,</span> <span class="s2">&quot;v_xc&quot;</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">rgrid</span><span class="p">,</span> <span class="n">potential</span><span class="o">.</span><span class="n">v_en</span><span class="p">,</span> <span class="n">potential</span><span class="o">.</span><span class="n">v_ha</span><span class="p">,</span> <span class="n">potential</span><span class="o">.</span><span class="n">v_xc</span><span class="p">[</span><span class="s2">&quot;xc&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
        <span class="p">)</span>

    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">% 10.5e</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">headstr</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">return</span></div>


<div class="viewcode-block" id="eigs_occs_to_csv"><a class="viewcode-back" href="../../api/atoMEC.html#atoMEC.writeoutput.eigs_occs_to_csv">[docs]</a><span class="k">def</span> <span class="nf">eigs_occs_to_csv</span><span class="p">(</span><span class="n">orbitals</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write all the orbital energies and their occupations to file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    orbitals: staticKS.Orbitals</span>
<span class="sd">        the orbitals object</span>
<span class="sd">    filename : str</span>
<span class="sd">        name of the file to write to</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data_tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">spindims</span><span class="p">):</span>
        <span class="c1"># flatten out the relevant matrices</span>
        <span class="c1"># and sort by energy eigenvalue</span>
        <span class="n">eigs_sp</span> <span class="o">=</span> <span class="n">orbitals</span><span class="o">.</span><span class="n">eigvals</span><span class="p">[:,</span> <span class="n">sp</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">idr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">eigs_sp</span><span class="p">)</span>
        <span class="n">eigs_sp</span> <span class="o">=</span> <span class="n">eigs_sp</span><span class="p">[</span><span class="n">idr</span><span class="p">]</span>
        <span class="n">occs_sp</span> <span class="o">=</span> <span class="n">orbitals</span><span class="o">.</span><span class="n">occnums</span><span class="p">[:,</span> <span class="n">sp</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="n">idr</span><span class="p">]</span>
        <span class="n">dos_sp</span> <span class="o">=</span> <span class="n">orbitals</span><span class="o">.</span><span class="n">DOS</span><span class="p">[:,</span> <span class="n">sp</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="n">idr</span><span class="p">]</span>
        <span class="n">ldegen_sp</span> <span class="o">=</span> <span class="n">orbitals</span><span class="o">.</span><span class="n">ldegen</span><span class="p">[:,</span> <span class="n">sp</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="n">idr</span><span class="p">]</span>
        <span class="n">band_weight_sp</span> <span class="o">=</span> <span class="n">orbitals</span><span class="o">.</span><span class="n">kpt_int_weight</span><span class="p">[:,</span> <span class="n">sp</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="n">idr</span><span class="p">]</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="n">eigs_sp</span><span class="p">,</span> <span class="n">occs_sp</span><span class="p">,</span> <span class="n">dos_sp</span><span class="p">,</span> <span class="n">ldegen_sp</span><span class="p">,</span> <span class="n">band_weight_sp</span><span class="p">])</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data_tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">data_tot</span><span class="p">,</span> <span class="n">data</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">data_tot</span> <span class="o">=</span> <span class="n">data</span>

    <span class="c1"># right-justifing column heads with fixed width of 12 characters</span>
    <span class="n">headstr</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">spindims</span> <span class="o">*</span> <span class="p">(</span>
        <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;eigs&quot;</span><span class="p">,</span> <span class="s2">&quot;occs&quot;</span><span class="p">,</span> <span class="s2">&quot;dos&quot;</span><span class="p">,</span> <span class="s2">&quot;l_degen&quot;</span><span class="p">,</span> <span class="s2">&quot;k_int_wt&quot;</span><span class="p">])</span>
        <span class="o">+</span> <span class="s2">&quot; &quot;</span>
    <span class="p">)</span>

    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">data_tot</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">% 10.5e</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">headstr</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">return</span></div>


<div class="viewcode-block" id="dos_to_csv"><a class="viewcode-back" href="../../api/atoMEC.html#atoMEC.writeoutput.dos_to_csv">[docs]</a><span class="k">def</span> <span class="nf">dos_to_csv</span><span class="p">(</span><span class="n">orbitals</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write the energy eigenvalues, Fermi-Dirac occupations and DOS to file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    orbitals: staticKS.Orbitals</span>
<span class="sd">        the orbitals object</span>
<span class="sd">    filename : str</span>
<span class="sd">        name of the file to write to</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data_tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">spindims</span><span class="p">):</span>

        <span class="c1"># compute the dos (*(2l+1)) and FD dist in amenable format</span>
        <span class="n">e_arr</span><span class="p">,</span> <span class="n">fd_arr</span><span class="p">,</span> <span class="n">DOS_arr</span> <span class="o">=</span> <span class="n">orbitals</span><span class="o">.</span><span class="n">calc_DOS_sum</span><span class="p">(</span>
            <span class="n">orbitals</span><span class="o">.</span><span class="n">eigvals_min</span><span class="p">,</span> <span class="n">orbitals</span><span class="o">.</span><span class="n">eigvals_max</span><span class="p">,</span> <span class="n">orbitals</span><span class="o">.</span><span class="n">ldegen</span>
        <span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="n">e_arr</span><span class="p">[:,</span> <span class="n">sp</span><span class="p">],</span> <span class="n">fd_arr</span><span class="p">[:,</span> <span class="n">sp</span><span class="p">],</span> <span class="n">DOS_arr</span><span class="p">[:,</span> <span class="n">sp</span><span class="p">]])</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">data_tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">data_tot</span><span class="p">,</span> <span class="n">data</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">data_tot</span> <span class="o">=</span> <span class="n">data</span>

    <span class="c1"># right-justifing column heads with fixed width of 12 characters</span>
    <span class="n">headstr</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">spindims</span> <span class="o">*</span> <span class="p">(</span>
        <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="s2">&quot; fd occ&quot;</span><span class="p">,</span> <span class="s2">&quot;dos&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
    <span class="p">)</span>

    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">data_tot</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">% 10.5e</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">headstr</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">return</span></div>


<span class="c1"># timing wrapper</span>
<div class="viewcode-block" id="timing"><a class="viewcode-back" href="../../api/atoMEC.html#atoMEC.writeoutput.timing">[docs]</a><span class="k">def</span> <span class="nf">timing</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate timing information for given input function.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    f : func</span>
<span class="sd">        the function to be timed</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="n">te</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;func:</span><span class="si">%r</span><span class="s2"> took: </span><span class="si">%2.4f</span><span class="s2"> sec&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">te</span> <span class="o">-</span> <span class="n">ts</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">return</span> <span class="n">wrap</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, CASUS.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>